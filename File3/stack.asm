;R0/R1/R6/R7 OCCUPIED       R2/R3/R4/R5 FREE
		
		.ORIG X3000
		AND R1 R1 #0
		LD R1 EXP		;R1 USED AS STRING POINTER
		LD R6 INT

A		ADD R1 R1 #1	
		LDR R0 R1 #0		;R0 USED AS STRING READER
		AND R2 R2 #0
		AND R3 R3 #0
		AND R4 R4 #0
		LD R4 CONV1
		LD R2 EOT
		LD R3 CPAR
		ADD R2 R2 R0
		BRz C
		ADD R3 R3 R0
		BRz B
		ADD R0 R0 R4	;CONVERT ASCII TO DECIMAL
		AND R5 R5 #0
		LDI R5 PUSHA	;LOAD ADDRESS OF PUSH INTO R5
		JSRR R5
		BRnzp A
		
C		AND R0 R0 #0
		AND R5 R5 #0
		LDI R5 POPA
		JSRR R5
		LD R5 SAVER5
		STI R0 ANS
		HALT

B		AND R2 R2 0
		AND R3 R3 0
		AND R4 R4 0
		AND R5 R5 #0
		LDI R5 POPA
		JSRR R5
		ADD R2 R2 R0			;R2 IS FIRST NUMBER
		AND R5 R5 #0
		LDI R5 POPA
		JSRR R5
		ADD R3 R3 R0			;R3 IS OPERATION
		AND R5 R5 #0
		LDI R5 POPA
		JSRR R5
		ADD R4 R4 R0			;R4 IS SECOND NUMBER
		ST R7 SAVER7
		AND R7 R7 #0
		LD R7 PLUS
		ADD R7 R7 R3
		BRz ADD1
		AND R7 R7 #0
		LD R7 SUBT
		ADD R7 R7 R3
		BRz SUB
		AND R7 R7 #0
		LD R7 MULT
		ADD R7 R7 R3
		BRz MULPP
D		AND R0 R0 #0
		ADD R0 R7 #0
		AND R7 R7 #0
		LD R7 SAVER7
		ADD R6 R6 #1
		AND R5 R5 #0
		LDI R5 PUSHA
		JSRR R5
		BRnzp A		
				
MULPP	AND R7 R7 #0
		ADD R4 R4 #0
		BRn MULNP
		ADD R2 R2 #0
		BRn MULPN
MA1		ADD R7 R7 R2
		ADD R4 R4 #-1
		BRnp MA1
		BRnzp D
		
MULNP	ADD R2 R2 #0
		BRn MULNN
MA2		ADD R7 R7 R4
		ADD R2 R2 #-1
		BRnp MA2
		BRz D
		
MULPN	ADD R7 R7 R2
		ADD R4 R4 #-1
		BRnp MULPN
		BRnzp D

MULNN	ADD R7 R7 R4
		ADD R2 R2 #1
		BRnp MULNN
		BRnzp D	
		
SUB		NOT R2 R2
		ADD R2 R2 #1
		ADD R7 R4 R2 
		BRnzp D	
		
ADD1	ADD R7 R2 R4
		BRnzp D
		
SAVER5	.BLKW #1		
SAVER7	.BLKW #1
ANS		.FILL X4000		; ANSWER LOCATION
EXP		.FILL X4002		; LOCATION OF FIRST EXPRESSION STRING
INT		.FILL XFE00		; R6 INITIALIZE
CONV1	.FILL #-48		; NUMBER TO CONVERT ASCII CHAR TO DECIM
CPAR	.FILL #-41		; - )
MULT	.FILL #6		; - *
PLUS	.FILL #5		; - +
SUBT	.FILL #3		; --
EOT		.FILL #-59		; - ;

;PUSH	ADD R6 R6 #-1
;		STR R0 R6 #0
;		RET
		
;POP		LDR R0 R6 #0
;		ADD R6 R6 #1
;		RET
		
PUSHA	.FILL x4001		;CONTAINS ADDRESS OF PUSH
POPA	.FILL x4002		;CONTAINS ADDRESS OF POP
		
		.END